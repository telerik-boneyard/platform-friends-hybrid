(function(a,b){if(typeof define==="function"&&define.amd){define(["Everlive"],function(c){b(c)})}else{b(a.Everlive)}}(this,function(n){var h=window.jQuery,j=window.kendo;if(h===undefined||j===undefined){return}var i=h.extend;i(true,j.data,{schemas:{everlive:{type:"json",data:function(o){if(typeof o.ModifiedAt!=="undefined"){return{ModifiedAt:o.ModifiedAt}}else{return o.Result||o}},total:"Count",model:{id:"Id"}}},transports:{everlive:{read:{dataType:"json",type:"GET",cache:false},update:{dataType:"json",contentType:"application/json",type:"PUT",cache:false},create:{dataType:"json",contentType:"application/json",type:"POST",cache:false},destroy:{dataType:"json",type:"DELETE",cache:false},parameterMap:function(p,o){if(o==="destroy"){return{}}if(o==="create"||o==="update"){return JSON.stringify(p)}if(o==="read"){return null}}}}});function l(s){var o={};if(s){if(s.skip){o.$skip=s.skip;delete s.skip}if(s.take){o.$take=s.take;delete s.take}if(s.sort){var r=s.sort;var p={};if(!h.isArray(r)){r=[r]}h.each(r,function(t,u){p[u.field]=u.dir==="asc"?1:-1});o.$sort=p;delete s.sort}if(s.filter){var q=new k().build(s.filter);o.$where=q;delete s.filter}}return o}var m=["startswith","startsWith","endswith","endsWith","contains"];function k(){}k.prototype={build:function(o){return this._build(o)},_build:function(o){if(this._isRaw(o)){return this._raw(o)}else{if(this._isSimple(o)){return this._simple(o)}else{if(this._isRegex(o)){return this._regex(o)}else{if(this._isAnd(o)){return this._and(o)}else{if(this._isOr(o)){return this._or(o)}}}}}},_isRaw:function(o){return o.operator==="_raw"},_raw:function(p){var o={};o[p.field]=p.value;return o},_isSimple:function(o){return typeof o.logic==="undefined"&&!this._isRegex(o)},_simple:function(r){var q={},o={};var p=this._translateoperator(r.operator);if(p){q[p]=r.value}else{q=r.value}o[r.field]=q;return o},_isRegex:function(o){return h.inArray(o.operator,m)!==-1},_regex:function(q){var o={};var r=this._getRegex(q);var p=this._getRegexValue(r);o[q.field]=p;return o},_getRegex:function(p){var q=p.value;var o=p.operator;switch(o){case"contains":return new RegExp(".*"+q+".*","i");case"startsWith":case"startswith":return new RegExp("^"+q,"i");case"endsWith":case"endswith":return new RegExp(q+"$","i")}throw new Error("Unknown operator type.")},_getRegexValue:function(o){return n.QueryBuilder.prototype._getRegexValue.call(this,o)},_isAnd:function(o){return o.logic==="and"},_and:function(t){var s,p,r,o={};var q=t.filters;for(s=0,p=q.length;s<p;s++){r=this._build(q[s]);o=this._andAppend(o,r)}return o},_andAppend:function(p,o){return n.QueryBuilder.prototype._andAppend.call(this,p,o)},_isOr:function(o){return o.logic==="or"},_or:function(t){var s,p,r,o=[];var q=t.filters;for(s=0,p=q.length;s<p;s++){r=this._build(q[s]);o.push(r)}return{$or:o}},_translateoperator:function(o){switch(o){case"eq":return null;case"neq":return"$ne";case"gt":return"$gt";case"lt":return"$lt";case"gte":return"$gte";case"lte":return"$lte"}throw new Error("Unknown operator type.")}};function b(o){return new n.Query(o.$where,null,o.$sort,o.$skip,o.$take)}var g=j.data.RemoteTransport.prototype.setup;j.data.RemoteTransport.prototype.setup=function(p,q){if(!p.url&&!this.options[q].url&&this.options.typeName){var t=this.options.dataProvider||n.$;if(!t){throw new Error("You should either specify a url for this transport method, or instantiate an Everlive instance.")}p.url=n.Request.prototype.buildUrl(t.setup)+this.options.typeName;if(q==="update"||q==="destroy"){p.url+="/"+p.data[n.idField]}p.headers=n.Request.prototype.buildAuthHeader(t.setup);if(q==="read"&&p.data){var r=l(p.data);var o=b(r);p.headers=h.extend(p.headers,n.Request.prototype.buildQueryHeaders(o))}if(q==="create"||q==="read"||q==="update"){var s=p.success;p.success=function(u){n._traverseAndRevive(u);if(s){s(u)}}}}return g.call(this,p,q)};var d=[n.idField,"CreatedAt"];var c=j.data.Model.prototype.accept;j.data.Model.prototype.accept=function(q){var o=this,r,p;n._traverseAndRevive(q);if(q&&o.isNew()&&q[n.idField]){for(r in o.fields){if(h.inArray(r,d)===-1){p=o.get(r);q[r]=p}}}else{if(q&&typeof q.ModifiedAt!=="undefined"){for(r in o.fields){if(r!=="ModifiedAt"){p=o.get(r);q[r]=p}}}}c.call(this,q)};var e=function(p,t){var r=f(t[t.length-1]);var q=t.slice(0,t.length-1);var s="/_expand";for(var o=0;o<q.length;o++){s+="/"+f(q[o])}return(function(v,u){return function(x){var w=p+"";if(x.Id&&u){w+=v+"/"+x.Id+"/"+u}return w}}(s,r))};var a=function(o){if(typeof o==="string"){return{}}else{return{"X-Everlive-Filter":JSON.stringify(o.filter),"X-Everlive-Sort":JSON.stringify(o.sort),"X-Everlive-Single-Field":o.singleField,"X-Everlive-Skip":o.skip,"X-Everlive-Take":o.take,"X-Everlive-Fields":JSON.stringify(o.fields)}}};var f=function(o){if(typeof o==="string"){return o}else{if(o.relation){return o.relation}else{throw new Error("You need to specify a 'relation' for an expand node when using the object notation")}}};n.createHierarchicalDataSource=function(p){p=p||{};var r=p.expand;var o=p.typeName;var v=p.dataProvider||n.$;delete p.expand;delete p.typeName;delete p.dataProvider;var s;if(p.url){s=p.url}else{if(v&&o){s=n.Request.prototype.buildUrl(v.setup)+o}else{if(!v){throw new Error("You need to instantiate an Everlive instance in order to create a kendo HierarchicalDataSource.")}if(!o){throw new Error("You need to specify a 'typeName' in order to create a kendo HierarchicalDataSource.")}}}var u;if(r){for(var q=r.length-1;q>=0;q--){var u={model:{hasChildren:f(r[q]),children:{type:"everlive",transport:{read:{url:e(s,r.slice(0,q+1)),headers:a(r[q])}},schema:u}}}}}var t={};t.type="everlive";t.transport={typeName:o,dataProvider:v};t.schema=u;i(true,t,p);return new j.data.HierarchicalDataSource(t)};n.createDataSource=function(p){p=p||{};var o=p.typeName;var r=p.dataProvider||n.$;if(!r){throw new Error("You need to instantiate an Everlive instance in order to create a kendo DataSource.")}if(!o){throw new Error("You need to specify a 'typeName' in order to create a kendo DataSource.")}delete p.typeName;delete p.dataProvider;var q={};q.type="everlive";q.transport={typeName:o,dataProvider:r};i(true,q,p);return new j.data.DataSource(q)}}));